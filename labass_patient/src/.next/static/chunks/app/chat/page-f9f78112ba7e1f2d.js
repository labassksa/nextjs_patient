(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{3646:function(e,t,n){Promise.resolve().then(n.bind(n,8818))},8818:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var s=n(4888),o=n(9318),r=n(6300),c=e=>{let{onSendMessage:t}=e,[n,r]=(0,o.useState)(!1),[c,l]=(0,o.useState)(""),a=(0,o.useRef)(null);return(0,s.jsxs)("div",{className:"sticky bottom-0 bg-white p-4 flex items-center border-t",children:[(0,s.jsx)("button",{className:"p-2",children:(0,s.jsx)("svg",{className:"w-6 h-6 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})}),(0,s.jsx)("button",{className:"p-2 mx-2",children:(0,s.jsx)("svg",{className:"w-6 h-6 text-gray-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M19 10V12C19 13.8565 18.2625 15.637 16.9497 16.9497C15.637 18.2625 13.8565 19 12 19M12 19C10.1435 19 8.36301 18.2625 7.05025 16.9497C5.7375 15.637 5 13.8565 5 12V10M12 19V23M8 23H16M12 1C11.2044 1 10.4413 1.31607 9.87868 1.87868C9.31607 2.44129 9 3.20435 9 4V12C9 12.7956 9.31607 13.5587 9.87868 14.1213C10.4413 14.6839 11.2044 15 12 15C12.7956 15 13.5587 14.6839 14.1213 14.1213C14.6839 13.5587 15 12.7956 15 12V4C15 3.20435 14.6839 2.44129 14.1213 1.87868C13.5587 1.31607 12.7956 1 12 1Z"})})}),(0,s.jsx)("input",{ref:a,type:"text",dir:"rtl",placeholder:"اكتب رسالة...",value:c,onChange:e=>l(e.target.value),className:"flex-grow p-2 border rounded-full outline-none text-sm",onFocus:()=>{r(!0),a.current&&a.current.focus()},onBlur:()=>r(!1)}),(0,s.jsx)("button",{className:"p-2 ".concat(n?"text-green-500":"text-gray-500"),onClick:()=>{console.log("Message to send:",c),""!==c.trim()&&(t(c),l("")),a.current&&a.current.focus()},children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M2.5 12.5L21.5 3.5L14.5 12.5L21.5 21.5L2.5 12.5Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})},l=e=>{let{consultationId:t,showActions:n,messages:r,handleSendMessage:l}=e;return r.forEach(e=>{console.log("The isSent inside chatMainContents".concat(e.isSent))}),(0,o.useEffect)(()=>{console.log("Consultation ID:",t)},[t]),(0,s.jsxs)("div",{className:"flex flex-col h-full text-black relative",children:[(0,s.jsx)("div",{className:"flex-grow overflow-y-auto p-4 bg-gray-100 text-sm mt-16",dir:"rtl",children:r.map(e=>(0,s.jsxs)("div",{dir:"rtl",className:"mb-4 p-3 rounded-lg max-w-xs ".concat(2===e.senderId?"bg-custom-background":"bg-white"),children:[e.message,2===e.senderId&&(0,s.jsx)("div",{className:"text-right",children:e.isSent&&(0,s.jsx)("svg",{className:"w-4 h-4 mt-1 ".concat(e.read?"text-green-600":"text-gray-500"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})})]},e.id))}),(0,s.jsx)(c,{onSendMessage:l})]})},a=n(798),i=e=>{let t=(0,o.useRef)(null),[n,s]=(0,o.useState)(!1),[r,c]=(0,o.useState)(!1);return(0,o.useEffect)(()=>(t.current=(0,a.io)(e,{reconnectionAttempts:5,reconnectionDelay:1e3}),t.current.on("connect",()=>{var e;s(!0),c(!1),console.log("Socket connected:",null===(e=t.current)||void 0===e?void 0:e.id)}),t.current.on("disconnect",()=>{s(!1),console.log("Socket disconnected")}),t.current.on("reconnect_attempt",e=>{c(!0),console.log("Reconnection attempt ".concat(e))}),t.current.on("reconnect_failed",()=>{c(!1),console.log("Reconnection failed")}),()=>{t.current&&t.current.disconnect()}),[e]),{socket:t.current,isConnected:n,attemptingReconnection:r,emitEvent:(e,s)=>{t.current&&n?t.current.emit(e,s):console.warn("Socket is not connected. Cannot send message.")}}},d=()=>{let[e,t]=(0,o.useState)([]),{socket:n,isConnected:c}=i("http://localhost:4000");return(0,o.useEffect)(()=>{if(!n)return;console.log("Socket initialized:",n),n.emit("joinRoom",{room:"".concat(3)});let e=e=>{console.log("Received message:",e),t(t=>2===e.senderId?t.map(t=>t.id===e.id?e:t):-1===t.findIndex(t=>t.id===e.id)?[...t,e]:t),2!==e.senderId&&n.emit("messageReceived",{messageId:e.id})},s=e=>{let{messageId:n,read:s}=e;console.log("Message ".concat(n," status updated to read: ").concat(s)),t(e=>e.map(e=>e.id===n?{...e,read:s}:e))};return n.on("receiveMessage",e),n.on("messageStatus",s),()=>{console.log("Cleaning up socket listeners"),n.off("receiveMessage",e),n.off("messageStatus",s)}},[n]),(0,s.jsxs)("div",{className:"flex flex-col h-screen bg-white",children:[(0,s.jsx)(r.default,{title:"استشارة فورية",showBackButton:!0}),(0,s.jsx)(l,{consultationId:3,showActions:!0,messages:e,handleSendMessage:s=>{if(!c||!n){console.error("Socket is not connected. Message cannot be sent.");return}let o={id:e.length+1,message:s,senderId:2,consultationId:3,isSent:!1,read:!1};t(e=>[...e,o]),console.log("Emitting sendMessage event with data:",{room:"".concat(3),message:s,consultationId:3,senderId:2}),n.emit("sendMessage",{room:"".concat(3),message:s,consultationId:3,senderId:2},e=>{t(t=>t.map(t=>t.id===o.id?{...t,id:e.messageId,isSent:!0}:t))})}})]})}},6300:function(e,t,n){"use strict";var s=n(4888);n(9318);var o=n(7701),r=n(4517);t.default=e=>{let{title:t,showBackButton:n=!1}=e,c=(0,o.useRouter)();return(0,s.jsxs)("div",{className:"fixed top-0 w-full bg-white p-4 flex items-center justify-between z-10",children:[(0,s.jsx)("h1",{className:"text-lg text-gray-500 font-normal flex-grow text-center",children:t}),n&&(0,s.jsx)("button",{onClick:()=>c.back(),className:"ml-2",children:(0,s.jsx)(r.Z,{className:"h-5 w-5 text-gray-500","aria-hidden":"true"})})]})}}},function(e){e.O(0,[927,768,419,248,744],function(){return e(e.s=3646)}),_N_E=e.O()}]);